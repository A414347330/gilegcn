<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç« é±¼æ™ºèƒ½ç¢ç‰‡åŒ–éŸ³é¢‘æ’­æ”¾å™¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00f5ff;
            --secondary-color: #ff00ff;
            --accent-color: #ffff00;
            --bg-primary: #0a0a0a;
            --bg-secondary: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #00ff88;
            --error-color: #ff4757;
            --warning-color: #ffa502;
            --shadow-glow: 0 0 30px rgba(0, 245, 255, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, #1a1a2e 0%, #16213e 25%, #0f0f23 50%, #000000 100%);
            z-index: -2;
        }
        
        .background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23ffffff" stroke-width="0.1" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>') repeat;
            opacity: 0.3;
        }
        
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.6;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--bg-secondary);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px var(--border-color);
            position: relative;
            z-index: 1;
            animation: slideUp 0.8s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        .section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid var(--border-color);
        }
        
        .section:last-child {
            margin-bottom: 0;
        }
        
        h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        /* éŸ³é¢‘å¯è§†åŒ–å™¨ */
        .visualizer-controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .viz-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 8px 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .viz-btn:hover, .viz-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }
        
        #audioVisualizer {
            width: 100%;
            height: 280px;
            background: radial-gradient(circle at center, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.98) 100%);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            box-shadow: inset 0 0 30px rgba(0, 245, 255, 0.15);
        }
        
        /* æ–‡ä»¶ä¸Šä¼  */
        .upload-area {
            border: 2px dashed rgba(0, 245, 255, 0.3);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(0, 245, 255, 0.05);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.2);
        }
        
        .upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(0, 245, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.7;
        }
        
        .upload-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .upload-hint {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* æ’­æ”¾å™¨æ§åˆ¶ */
        .player-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .now-playing {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .album-art {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.1rem;
            box-shadow: var(--shadow-glow);
            transition: transform 0.3s ease;
        }
        
        .album-art.playing {
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .track-info {
            margin-bottom: 15px;
        }
        
        .current-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .current-details {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .progress-section {
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            margin-bottom: 8px;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .control-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            color: var(--text-primary);
        }
        
        .control-btn.play-pause {
            width: 70px;
            height: 70px;
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .mode-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 12px 0;
        }
        
        .mode-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 16px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .volume-section {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }
        
        /* æ’­æ”¾åˆ—è¡¨ */
        .playlist {
            max-height: 350px;
            overflow-y: auto;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .playlist-item:hover {
            background: rgba(0, 245, 255, 0.08);
            border-color: rgba(0, 245, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .playlist-item.playing {
            background: rgba(0, 245, 255, 0.12);
            border-color: var(--primary-color);
        }
        
        .track-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
            color: white;
        }
        
        .track-details {
            flex: 1;
        }
        
        .track-name {
            font-weight: 500;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .track-duration {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .track-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .playlist-item:hover .track-actions {
            opacity: 1;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            padding: 6px 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        
        .action-btn:hover {
            background: var(--error-color);
            color: white;
        }
        
        /* é€šçŸ¥ç³»ç»Ÿ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            color: var(--text-primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-color: var(--success-color);
        }
        
        .notification.error {
            border-color: var(--error-color);
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
        }
        

        
        /* å“åº”å¼è®¾è®¡ */
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .controls {
                gap: 15px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
            
            .control-btn.play-pause {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

    
    <div class="background"></div>
    <div class="floating-particles"></div>
    
    <div class="container">
        <header class="header">
            <h1>ç« é±¼æ™ºèƒ½ç¢ç‰‡åŒ–éŸ³é¢‘æ’­æ”¾å™¨</h1>
            <p class="subtitle">ä¸“ä¸šéŸ³é¢‘æ’­æ”¾ä½“éªŒ Â· æ™ºèƒ½å¯è§†åŒ–æ•ˆæœ Â· å¤šæ¨¡å¼æ’­æ”¾æ§åˆ¶</p>
        </header>
        
        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <div class="section upload-section">
            <h2>ğŸ“ éŸ³é¢‘æ–‡ä»¶åŠ è½½</h2>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸµ</div>
                <div class="upload-text">æ‹–æ‹½éŸ³é¢‘æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»é€‰æ‹©</div>
                <div class="upload-hint">æ”¯æŒ MP3, WAV, OGG, M4A, AAC, FLAC ç­‰æ ¼å¼</div>
                <input type="file" id="fileInput" accept="audio/*" multiple style="display: none;">
            </div>
        </div>
        
        <!-- éŸ³é¢‘å¯è§†åŒ–å™¨ -->
        <div class="section visualizer-section">
            <h2>ğŸŒŠ éŸ³é¢‘å¯è§†åŒ–æ•ˆæœ</h2>
            <div class="visualizer-controls">
                <button class="viz-btn" data-mode="bars">é¢‘è°±æ¡</button>
                <button class="viz-btn" data-mode="wave">æ³¢å½¢å›¾</button>
                <button class="viz-btn" data-mode="circle">åœ†å½¢è°±</button>
                <button class="viz-btn" data-mode="particles">ç²’å­æ•ˆæœ</button>
                <button class="viz-btn active" data-mode="matrix">çŸ©é˜µæ•ˆæœ</button>
                <button class="viz-btn" data-mode="spiral">èºæ—‹è°±</button>
                <button class="viz-btn" data-mode="waveform">ç«‹ä½“æ³¢å½¢</button>
                <button class="viz-btn" data-mode="ripple">æ°´æ³¢çº¹</button>
            </div>
            <canvas id="audioVisualizer" width="800" height="280"></canvas>
        </div>
        
        <!-- æ’­æ”¾å™¨æ§åˆ¶ -->
        <div class="section player-section">
            <h2>ğŸ® æ’­æ”¾æ§åˆ¶</h2>
            <div class="player-controls">
                <div class="now-playing">
                    <div class="album-art" id="albumArt">ğŸ¶</div>
                    <div class="track-info">
                        <div class="current-title" id="currentTitle">é€‰æ‹©éŸ³é¢‘æ–‡ä»¶å¼€å§‹æ’­æ”¾</div>
                        <div class="current-details" id="currentDetails">ç« é±¼æ™ºèƒ½ç¢ç‰‡åŒ–éŸ³é¢‘æ’­æ”¾å™¨</div>
                    </div>
                </div>
                
                <div class="progress-section">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="time-display">
                        <span id="currentTime">00:00</span>
                        <span id="totalTime">00:00</span>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="control-btn" id="prevBtn" title="ä¸Šä¸€é¦–" disabled>â®</button>
                    <button class="control-btn play-pause" id="playBtn" title="æ’­æ”¾/æš‚åœ" disabled>â–¶</button>
                    <button class="control-btn" id="nextBtn" title="ä¸‹ä¸€é¦–" disabled>â­</button>
                </div>
                
                <div class="mode-controls">
                    <button class="mode-btn active" id="sequentialBtn" data-mode="sequential">ğŸ”¢ é¡ºåºæ’­æ”¾</button>
                    <button class="mode-btn" id="randomBtn" data-mode="random">ğŸ”€ éšæœºæ’­æ”¾</button>
                    <button class="mode-btn" id="loopBtn" data-mode="loop">ğŸ” å¾ªç¯æ’­æ”¾</button>
                </div>
                
                <div class="volume-section">
                    <span>ğŸ”Š</span>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
                    <span id="volumeValue">70%</span>
                </div>
            </div>
        </div>
        
        <!-- æ’­æ”¾åˆ—è¡¨ -->
        <div class="section playlist-section">
            <h2>ğŸ“‚ æ’­æ”¾åˆ—è¡¨</h2>
            <div class="playlist" id="playlist">
                <div style="text-align: center; color: var(--text-secondary); padding: 40px 20px; font-style: italic;">
                    ğŸ¼ æš‚æ— éŸ³é¢‘æ–‡ä»¶<br>
                    è¯·æ·»åŠ éŸ³é¢‘æ–‡ä»¶åˆ°æ’­æ”¾åˆ—è¡¨
                </div>
            </div>
        </div>
    </div>
    
    <audio id="audioPlayer" preload="metadata"></audio>
    
    <script>
        class OctopusAudioPlayer {
            constructor() {
                this.tracks = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.playMode = 'sequential';
                this.visualizerMode = 'matrix';
                this.autoPlay = true;
                
                // éŸ³é¢‘åˆ†æç›¸å…³
                this.audioContext = null;
                this.analyser = null;
                this.dataArray = null;
                this.source = null;
                this.gainNode = null;
                
                // Canvasç›¸å…³
                this.canvas = null;
                this.canvasCtx = null;
                this.animationId = null;
                
                this.initElements();
                this.bindEvents();
                this.initVisualizer();
            }
            
            initElements() {
                this.audioPlayer = document.getElementById('audioPlayer');
                this.fileInput = document.getElementById('fileInput');
                this.uploadArea = document.getElementById('uploadArea');
                this.playlist = document.getElementById('playlist');
                this.currentTitle = document.getElementById('currentTitle');
                this.currentDetails = document.getElementById('currentDetails');
                this.albumArt = document.getElementById('albumArt');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.currentTime = document.getElementById('currentTime');
                this.totalTime = document.getElementById('totalTime');
                this.playBtn = document.getElementById('playBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.volumeValue = document.getElementById('volumeValue');
                this.sequentialBtn = document.getElementById('sequentialBtn');
                this.randomBtn = document.getElementById('randomBtn');
                this.loopBtn = document.getElementById('loopBtn');
                this.visualizer = document.getElementById('audioVisualizer');
            }
            
            initVisualizer() {
                this.canvas = this.visualizer;
                this.canvasCtx = this.canvas.getContext('2d');
                
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width * window.devicePixelRatio;
                this.canvas.height = rect.height * window.devicePixelRatio;
                this.canvasCtx.scale(window.devicePixelRatio, window.devicePixelRatio);
            }
            
            bindEvents() {
                // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
                this.fileInput.addEventListener('change', (e) => this.handleFiles(e.target.files));
                this.uploadArea.addEventListener('click', () => this.fileInput.click());
                this.uploadArea.addEventListener('dragover', (e) => this.handleDragOver(e));
                this.uploadArea.addEventListener('dragleave', (e) => this.handleDragLeave(e));
                this.uploadArea.addEventListener('drop', (e) => this.handleDrop(e));
                
                // æ’­æ”¾æ§åˆ¶äº‹ä»¶
                this.playBtn.addEventListener('click', () => this.togglePlay());
                this.prevBtn.addEventListener('click', () => this.previousTrack());
                this.nextBtn.addEventListener('click', () => this.nextTrack());
                this.progressBar.addEventListener('click', (e) => this.seekTo(e));
                this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value));
                
                // æ’­æ”¾æ¨¡å¼äº‹ä»¶
                this.sequentialBtn.addEventListener('click', () => this.setPlayMode('sequential'));
                this.randomBtn.addEventListener('click', () => this.setPlayMode('random'));
                this.loopBtn.addEventListener('click', () => this.setPlayMode('loop'));
                
                // å¯è§†åŒ–æ¨¡å¼äº‹ä»¶
                document.querySelectorAll('.viz-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.viz-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.visualizerMode = e.target.dataset.mode;
                    });
                });
                
                // éŸ³é¢‘æ’­æ”¾äº‹ä»¶
                this.audioPlayer.addEventListener('loadedmetadata', () => this.updateTrackInfo());
                this.audioPlayer.addEventListener('timeupdate', () => this.updateProgress());
                this.audioPlayer.addEventListener('ended', () => this.handleTrackEnd());
                
                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));
                
                // åˆå§‹åŒ–éŸ³é‡
                this.setVolume(70);
            }
            
            handleFiles(files) {
                const audioFiles = Array.from(files).filter(file => 
                    file.type.startsWith('audio/') || 
                    /\.(mp3|wav|ogg|m4a|aac|flac|wma|opus)$/i.test(file.name)
                );
                
                if (audioFiles.length === 0) {
                    this.showNotification('æœªæ‰¾åˆ°æ”¯æŒçš„éŸ³é¢‘æ–‡ä»¶', 'error');
                    return;
                }
                
                audioFiles.forEach(file => {
                    const track = {
                        id: Date.now() + Math.random(),
                        name: file.name.replace(/\.[^/.]+$/, ''),
                        file: file,
                        url: URL.createObjectURL(file),
                        duration: 0
                    };
                    
                    this.tracks.push(track);
                    this.loadDuration(track);
                });
                
                this.updatePlaylistDisplay();
                this.updateControls();
                
                if (this.tracks.length === audioFiles.length && this.autoPlay) {
                    this.loadTrack(0, true);
                    this.showNotification(`å·²æ·»åŠ  ${audioFiles.length} ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼Œå¼€å§‹è‡ªåŠ¨æ’­æ”¾`, 'success');
                } else {
                    this.showNotification(`å·²æ·»åŠ  ${audioFiles.length} ä¸ªéŸ³é¢‘æ–‡ä»¶`, 'success');
                }
            }
            
            handleDragOver(e) {
                e.preventDefault();
                this.uploadArea.classList.add('dragover');
            }
            
            handleDragLeave(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
            }
            
            handleDrop(e) {
                e.preventDefault();
                this.uploadArea.classList.remove('dragover');
                this.handleFiles(e.dataTransfer.files);
            }
            
            loadTrack(index, shouldPlay = false) {
                if (index < 0 || index >= this.tracks.length) return;
                
                const track = this.tracks[index];
                this.currentIndex = index;
                this.audioPlayer.src = track.url;
                this.currentTitle.textContent = track.name;
                this.currentDetails.textContent = `ç¬¬ ${index + 1} é¦– / å…± ${this.tracks.length} é¦–`;
                
                this.updatePlaylistDisplay();
                this.audioPlayer.load();
                
                if (shouldPlay) {
                    setTimeout(() => {
                        this.playAudio();
                    }, 300);
                }
            }
            
            playAudio() {
                this.setupAudioContext();
                
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    this.audioContext.resume().then(() => {
                        this.startPlayback();
                    });
                } else {
                    this.startPlayback();
                }
            }
            
            startPlayback() {
                this.audioPlayer.play().then(() => {
                    this.playBtn.textContent = 'â¸';
                    this.isPlaying = true;
                    this.albumArt.classList.add('playing');
                    this.startVisualizer();
                }).catch(error => {
                    this.showNotification('æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', 'error');
                    console.error('æ’­æ”¾é”™è¯¯:', error);
                });
            }
            
            togglePlay() {
                if (this.tracks.length === 0) {
                    this.showNotification('è¯·å…ˆæ·»åŠ éŸ³é¢‘æ–‡ä»¶', 'error');
                    return;
                }
                
                if (this.isPlaying) {
                    this.audioPlayer.pause();
                    this.playBtn.textContent = 'â–¶';
                    this.isPlaying = false;
                    this.albumArt.classList.remove('playing');
                    this.stopVisualizer();
                } else {
                    if (!this.audioPlayer.src && this.tracks.length > 0) {
                        this.loadTrack(0, true);
                        return;
                    }
                    
                    this.playAudio();
                }
            }
            
            previousTrack() {
                if (this.tracks.length === 0) return;
                
                let newIndex;
                if (this.playMode === 'random') {
                    newIndex = Math.floor(Math.random() * this.tracks.length);
                } else {
                    newIndex = this.currentIndex > 0 ? this.currentIndex - 1 : this.tracks.length - 1;
                }
                
                this.loadTrack(newIndex, this.isPlaying);
            }
            
            nextTrack() {
                if (this.tracks.length === 0) return;
                
                let newIndex;
                if (this.playMode === 'random') {
                    newIndex = Math.floor(Math.random() * this.tracks.length);
                } else if (this.playMode === 'loop') {
                    newIndex = this.currentIndex;
                } else {
                    newIndex = this.currentIndex < this.tracks.length - 1 ? this.currentIndex + 1 : 0;
                }
                
                this.loadTrack(newIndex, this.isPlaying);
            }
            
            handleTrackEnd() {
                if (this.playMode === 'loop') {
                    this.audioPlayer.currentTime = 0;
                    this.audioPlayer.play().then(() => {
                        this.startVisualizer();
                    });
                } else {
                    this.stopVisualizer();
                    this.albumArt.classList.remove('playing');
                    this.nextTrack();
                }
            }
            
            seekTo(event) {
                if (this.audioPlayer.duration) {
                    const rect = this.progressBar.getBoundingClientRect();
                    const percent = (event.clientX - rect.left) / rect.width;
                    this.audioPlayer.currentTime = percent * this.audioPlayer.duration;
                }
            }
            
            setVolume(value) {
                this.audioPlayer.volume = value / 100;
                this.volumeValue.textContent = value + '%';
                
                if (this.gainNode) {
                    this.gainNode.gain.value = value / 100;
                }
            }
            
            setPlayMode(mode) {
                this.playMode = mode;
                document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(mode + 'Btn').classList.add('active');
            }
            
            updateProgress() {
                if (this.audioPlayer.duration) {
                    const percent = (this.audioPlayer.currentTime / this.audioPlayer.duration) * 100;
                    this.progressFill.style.width = percent + '%';
                    this.currentTime.textContent = this.formatTime(this.audioPlayer.currentTime);
                }
            }
            
            updateTrackInfo() {
                this.totalTime.textContent = this.formatTime(this.audioPlayer.duration);
            }
            
            updatePlaylistDisplay() {
                if (this.tracks.length === 0) {
                    this.playlist.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 40px 20px; font-style: italic;">
                            ğŸ¼ æš‚æ— éŸ³é¢‘æ–‡ä»¶<br>
                            è¯·æ·»åŠ éŸ³é¢‘æ–‡ä»¶åˆ°æ’­æ”¾åˆ—è¡¨
                        </div>
                    `;
                    return;
                }
                
                this.playlist.innerHTML = this.tracks.map((track, index) => `
                    <div class="playlist-item ${index === this.currentIndex ? 'playing' : ''}" data-index="${index}">
                        <div class="track-icon">ğŸµ</div>
                        <div class="track-details">
                            <div class="track-name">${track.name}</div>
                            <div class="track-duration">${this.formatTime(track.duration)}</div>
                        </div>
                        <div class="track-actions">
                            <button class="action-btn" onclick="player.removeTrack(${index})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
                
                this.playlist.querySelectorAll('.playlist-item').forEach((item, index) => {
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('action-btn')) {
                            this.loadTrack(index, true);
                        }
                    });
                });
            }
            
            removeTrack(index) {
                if (index < 0 || index >= this.tracks.length) return;
                
                const track = this.tracks[index];
                URL.revokeObjectURL(track.url);
                
                this.tracks.splice(index, 1);
                
                if (index < this.currentIndex) {
                    this.currentIndex--;
                } else if (index === this.currentIndex) {
                    if (this.currentIndex >= this.tracks.length) {
                        this.currentIndex = 0;
                    }
                    
                    if (this.tracks.length > 0) {
                        this.loadTrack(this.currentIndex, this.isPlaying);
                    } else {
                        this.audioPlayer.src = '';
                        this.currentTitle.textContent = 'é€‰æ‹©éŸ³é¢‘æ–‡ä»¶å¼€å§‹æ’­æ”¾';
                        this.currentDetails.textContent = 'ç« é±¼æ™ºèƒ½ç¢ç‰‡åŒ–éŸ³é¢‘æ’­æ”¾å™¨';
                        this.isPlaying = false;
                        this.playBtn.textContent = 'â–¶';
                        this.albumArt.classList.remove('playing');
                    }
                }
                
                this.updatePlaylistDisplay();
                this.updateControls();
                this.showNotification('å·²åˆ é™¤éŸ³é¢‘æ–‡ä»¶', 'success');
            }
            
            updateControls() {
                const hasFiles = this.tracks.length > 0;
                this.playBtn.disabled = !hasFiles;
                this.prevBtn.disabled = !hasFiles;
                this.nextBtn.disabled = !hasFiles;
            }
            
            loadDuration(track) {
                const audio = new Audio(track.url);
                audio.addEventListener('loadedmetadata', () => {
                    track.duration = audio.duration || 0;
                    this.updatePlaylistDisplay();
                });
                audio.addEventListener('error', () => {
                    track.duration = 0;
                });
            }
            
            setupAudioContext() {
                if (this.audioContext) return;
                
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 256;
                    
                    const bufferLength = this.analyser.frequencyBinCount;
                    this.dataArray = new Uint8Array(bufferLength);
                    
                    this.source = this.audioContext.createMediaElementSource(this.audioPlayer);
                    this.gainNode = this.audioContext.createGain();
                    
                    this.source.connect(this.gainNode);
                    this.gainNode.connect(this.analyser);
                    this.analyser.connect(this.audioContext.destination);
                } catch (error) {
                    console.error('éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–å¤±è´¥:', error);
                }
            }
            
            startVisualizer() {
                if (!this.audioContext || !this.analyser || !this.canvas) return;
                
                const draw = () => {
                    this.animationId = requestAnimationFrame(draw);
                    
                    this.analyser.getByteFrequencyData(this.dataArray);
                    
                    const ctx = this.canvasCtx;
                    const width = this.canvas.width / window.devicePixelRatio;
                    const height = this.canvas.height / window.devicePixelRatio;
                    
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                    ctx.fillRect(0, 0, width, height);
                    
                    this.drawVisualization(ctx, width, height, this.dataArray);
                };
                
                draw();
            }
            
            stopVisualizer() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            }
            
            drawVisualization(ctx, width, height, frequencyData) {
                switch (this.visualizerMode) {
                    case 'bars':
                        this.drawBars(ctx, width, height, frequencyData);
                        break;
                    case 'wave':
                        this.drawWave(ctx, width, height, frequencyData);
                        break;
                    case 'circle':
                        this.drawCircle(ctx, width, height, frequencyData);
                        break;
                    case 'particles':
                        this.drawParticles(ctx, width, height, frequencyData);
                        break;
                    case 'matrix':
                        this.drawMatrix(ctx, width, height, frequencyData);
                        break;
                    case 'spiral':
                        this.drawSpiral(ctx, width, height, frequencyData);
                        break;
                    case 'waveform':
                        this.drawWaveform3D(ctx, width, height, frequencyData);
                        break;
                    case 'ripple':
                        this.drawRipple(ctx, width, height, frequencyData);
                        break;
                }
            }
            
            drawBars(ctx, width, height, frequencyData) {
                const barWidth = width / frequencyData.length * 2.5;
                let x = 0;
                
                for (let i = 0; i < frequencyData.length; i++) {
                    const barHeight = (frequencyData[i] / 255) * height;
                    
                    const hue = (i / frequencyData.length) * 360;
                    ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                    
                    ctx.fillRect(x, height - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }
            
            drawWave(ctx, width, height, frequencyData) {
                ctx.strokeStyle = '#00f5ff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const sliceWidth = width / frequencyData.length;
                let x = 0;
                
                for (let i = 0; i < frequencyData.length; i++) {
                    const v = frequencyData[i] / 255;
                    const y = v * height / 2;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                    
                    x += sliceWidth;
                }
                
                ctx.stroke();
            }
            
            drawCircle(ctx, width, height, frequencyData) {
                const centerX = width / 2;
                const centerY = height / 2;
                const radius = Math.min(width, height) / 4;
                
                ctx.strokeStyle = '#00f5ff';
                ctx.lineWidth = 2;
                
                for (let i = 0; i < frequencyData.length; i++) {
                    const angle = (i / frequencyData.length) * Math.PI * 2;
                    const amplitude = frequencyData[i] / 255;
                    const x1 = centerX + Math.cos(angle) * radius;
                    const y1 = centerY + Math.sin(angle) * radius;
                    const x2 = centerX + Math.cos(angle) * (radius + amplitude * 50);
                    const y2 = centerY + Math.sin(angle) * (radius + amplitude * 50);
                    
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                }
            }
            
            drawParticles(ctx, width, height, frequencyData) {
                if (!this.particles) {
                    this.particles = [];
                    for (let i = 0; i < 100; i++) {
                        this.particles.push({
                            x: Math.random() * width,
                            y: Math.random() * height,
                            vx: (Math.random() - 0.5) * 2,
                            vy: (Math.random() - 0.5) * 2,
                            size: Math.random() * 3 + 1
                        });
                    }
                }
                
                const avgFreq = frequencyData.reduce((a, b) => a + b, 0) / frequencyData.length;
                const intensity = avgFreq / 255;
                
                this.particles.forEach(particle => {
                    particle.x += particle.vx * intensity;
                    particle.y += particle.vy * intensity;
                    
                    if (particle.x < 0 || particle.x > width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > height) particle.vy *= -1;
                    
                    ctx.fillStyle = `rgba(0, 245, 255, ${intensity})`;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size * intensity, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
            
            drawMatrix(ctx, width, height, frequencyData) {
                const cols = 32;
                const rows = 16;
                const cellWidth = width / cols;
                const cellHeight = height / rows;
                
                for (let i = 0; i < cols; i++) {
                    for (let j = 0; j < rows; j++) {
                        const dataIndex = Math.floor((i * rows + j) * frequencyData.length / (cols * rows));
                        const intensity = frequencyData[dataIndex] / 255;
                        
                        if (intensity > 0.1) {
                            const alpha = intensity;
                            const hue = (intensity * 120 + Date.now() * 0.01) % 360;
                            
                            ctx.fillStyle = `hsla(${hue}, 100%, 50%, ${alpha})`;
                            ctx.fillRect(i * cellWidth, j * cellHeight, cellWidth - 1, cellHeight - 1);
                        }
                    }
                }
            }
            
            drawSpiral(ctx, width, height, frequencyData) {
                const centerX = width / 2;
                const centerY = height / 2;
                const maxRadius = Math.min(width, height) / 3;
                
                ctx.strokeStyle = '#00f5ff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let i = 0; i < frequencyData.length; i++) {
                    const angle = (i / frequencyData.length) * Math.PI * 8;
                    const amplitude = frequencyData[i] / 255;
                    const radius = (i / frequencyData.length) * maxRadius + amplitude * 20;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
            }
            
            drawWaveform3D(ctx, width, height, frequencyData) {
                const layers = 5;
                const layerHeight = height / layers;
                
                for (let layer = 0; layer < layers; layer++) {
                    const alpha = 1 - (layer * 0.15);
                    const offset = layer * 10;
                    
                    ctx.strokeStyle = `rgba(0, 245, 255, ${alpha})`;
                    ctx.lineWidth = 3 - layer * 0.3;
                    ctx.beginPath();
                    
                    const sliceWidth = width / frequencyData.length;
                    let x = 0;
                    
                    for (let i = 0; i < frequencyData.length; i++) {
                        const v = frequencyData[i] / 255;
                        const y = layerHeight * (layer + 1) - (v * layerHeight) + offset;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                        
                        x += sliceWidth;
                    }
                    
                    ctx.stroke();
                }
            }
            
            drawRipple(ctx, width, height, frequencyData) {
                const centerX = width / 2;
                const centerY = height / 2;
                const maxRadius = Math.min(width, height) / 2;
                
                const avgFreq = frequencyData.reduce((a, b) => a + b, 0) / frequencyData.length;
                const intensity = avgFreq / 255;
                
                const rippleCount = 8;
                const time = Date.now() * 0.002;
                
                for (let i = 0; i < rippleCount; i++) {
                    const radius = ((time + i * 0.5) % 2) * maxRadius;
                    const alpha = (1 - (radius / maxRadius)) * intensity;
                    
                    if (alpha > 0) {
                        ctx.strokeStyle = `rgba(0, 245, 255, ${alpha})`;
                        ctx.lineWidth = 2 + intensity * 3;
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                }
                
                ctx.fillStyle = `rgba(255, 0, 255, ${intensity})`;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 5 + intensity * 10, 0, Math.PI * 2);
                ctx.fill();
            }
            
            formatTime(seconds) {
                if (isNaN(seconds)) return '00:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            handleKeyboard(e) {
                if (e.target.tagName === 'INPUT') return;
                
                switch (e.code) {
                    case 'Space':
                        e.preventDefault();
                        this.togglePlay();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        this.previousTrack();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        this.nextTrack();
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        const currentVolume = parseInt(this.volumeSlider.value);
                        this.volumeSlider.value = Math.min(100, currentVolume + 5);
                        this.setVolume(this.volumeSlider.value);
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        const currentVol = parseInt(this.volumeSlider.value);
                        this.volumeSlider.value = Math.max(0, currentVol - 5);
                        this.setVolume(this.volumeSlider.value);
                        break;
                }
            }
            
            showNotification(message, type = 'info') {
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.2rem;">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => notification.classList.add('show'), 100);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }
        

        
        // åˆå§‹åŒ–æ’­æ”¾å™¨
        const player = new OctopusAudioPlayer();
        
        // åˆ›å»ºæµ®åŠ¨ç²’å­æ•ˆæœ
        function initializeParticles() {
            const particlesContainer = document.querySelector('.floating-particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            initializeParticles();
        });
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            player.tracks.forEach(track => {
                if (track.url) {
                    URL.revokeObjectURL(track.url);
                }
            });
        });
    </script>
    
    <!-- å¼•å…¥å¯¼èˆªæ¡è„šæœ¬ -->
    <script src="navbar.js"></script>
</body>
</html>